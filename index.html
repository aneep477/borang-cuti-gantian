<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #020617; color: white; min-height: 100vh; }
        .glass { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 20px; }
        .input-style { background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); color: white; border-radius: 12px; padding: 12px; width: 100%; font-size: 13px; outline: none; transition: 0.3s; }
        .input-style:focus { border-color: #3b82f6; box-shadow: 0 0 10px rgba(59, 130, 246, 0.2); }
        .btn-ot { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .btn-cuti { background: linear-gradient(135deg, #10b981, #059669); }
    </style>
</head>
<body class="p-6 md:p-10">
    <div class="max-w-6xl mx-auto">
        <header class="flex justify-between items-center mb-10">
            <h1 class="text-2xl font-black italic tracking-tighter uppercase">C-HRIS <span class="text-blue-500">PRO</span></h1>
            <div class="glass px-4 py-2 text-[10px] font-bold text-blue-400 uppercase tracking-widest border border-blue-500/20">‚óè Haniff Faizal</div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <div class="glass p-8 relative overflow-hidden">
                <span class="absolute top-0 right-0 p-4 opacity-10 text-4xl italic font-black">HRS</span>
                <p class="text-slate-500 text-[10px] font-bold uppercase mb-1">Baki Jam Semasa</p>
                <div class="text-5xl font-black italic text-white" id="stat-baki">0.00</div>
            </div>
            <div class="glass p-8 border-l-4 border-red-500/40">
                <p class="text-red-500 text-[10px] font-bold uppercase mb-1">Jam Bakal Luput</p>
                <div class="text-5xl font-black text-red-500 italic">0.00</div>
            </div>
            <div class="glass p-8">
                <p class="text-slate-500 text-[10px] font-bold uppercase mb-1">Status Sistem</p>
                <div class="text-sm font-bold mt-2 text-emerald-400">‚óè Aktif & Stabil</div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <div class="lg:col-span-4 space-y-6">
                <div class="glass p-6 border border-blue-500/10">
                    <h2 class="text-blue-400 font-bold mb-5 text-[11px] uppercase tracking-[0.2em] flex items-center gap-2">
                        <span class="bg-blue-500/20 p-1.5 rounded-lg text-xs">+</span> Rekod OT Baru
                    </h2>
                    <form id="ot-form" class="space-y-4">
                        <input type="date" id="ot-date" class="input-style" required>
                        <input type="text" id="ot-task" placeholder="Nama Tugasan / Acara" class="input-style" required>
                        <div class="grid grid-cols-2 gap-3">
                            <input type="time" id="ot-start" class="input-style" required onchange="calcOT()">
                            <input type="time" id="ot-end" class="input-style" required onchange="calcOT()">
                        </div>
                        <div class="relative">
                           <input type="url" id="ot-link" placeholder="Link Surat (Google Drive/URL)" class="input-style pr-10">
                           <span class="absolute right-3 top-3.5 opacity-30 text-xs">üîó</span>
                        </div>

                        <div class="flex justify-between items-center px-1">
                            <span class="text-[10px] font-bold text-slate-500 uppercase">Jumlah Masa</span>
                            <span id="ot-val" class="text-sm font-black text-blue-400">0.00 Jam</span>
                        </div>
                        <button type="submit" class="btn-ot w-full py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest text-white shadow-lg shadow-blue-900/20 transition hover:scale-[1.02]">Simpan Rekod</button>
                    </form>
                </div>

                <div class="glass p-6 border border-emerald-500/10">
                    <h2 class="text-emerald-400 font-bold mb-5 text-[11px] uppercase tracking-[0.2em]">üå¥ Mohon Cuti Gantian</h2>
                    <form id="lv-form" class="space-y-4">
                        <div class="grid grid-cols-2 gap-3">
                            <input type="date" id="lv-s" class="input-style" required onchange="runLogic()">
                            <input type="date" id="lv-e" class="input-style" required onchange="runLogic()">
                        </div>
                        <input type="text" id="lv-d" class="input-style bg-white/5 opacity-60 cursor-not-allowed" readonly placeholder="Bilangan Hari">
                        
                        <div id="info-box" class="hidden p-4 bg-blue-500/5 border border-blue-500/10 rounded-xl space-y-3">
                            <div class="flex justify-between text-[10px] font-bold uppercase tracking-tighter">
                                <span class="text-slate-500">Jam Diperlukan</span>
                                <span id="val-perlu" class="text-blue-400">0.00j</span>
                            </div>
                            <div id="msg" class="text-[10px] text-center font-black py-1 rounded shadow-inner uppercase tracking-widest"></div>
                        </div>
                        <button type="submit" id="lv-btn" class="btn-cuti w-full py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest text-white shadow-lg shadow-emerald-900/20 transition hover:scale-[1.02]">Jana Lampiran A</button>
                    </form>
                </div>
            </div>

            <div class="lg:col-span-8 glass overflow-hidden border border-white/5 flex flex-col">
                <div class="p-6 border-b border-white/5 flex justify-between items-center">
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest italic">Log Aktiviti OT Terkumpul</h3>
                    <div class="h-2 w-2 rounded-full bg-blue-500 animate-pulse"></div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-[11px]">
                        <thead class="bg-white/5 text-slate-500 font-black uppercase tracking-tighter">
                            <tr>
                                <th class="p-5">Tarikh</th>
                                <th class="p-5">Tugasan</th>
                                <th class="p-5 text-center">Jam</th>
                                <th class="p-5 text-center">Surat</th>
                                <th class="p-5 text-right">Status</th>
                            </tr>
                        </thead>
                        <tbody id="table-body" class="divide-y divide-white/5"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API = 'https://script.google.com/macros/s/AKfycbybiGrzYRTQjwrfAy9QcE7baMWARJ4Ce7BC_Nq-WXwnMZM27NOKSwBa1zdL-uV9obDB/exec';

        function calcOT() {
            const s = document.getElementById('ot-start').value, e = document.getElementById('ot-end').value;
            if(!s || !e) return;
            let d = (new Date(`1970-01-01T${e}`) - new Date(`1970-01-01T${s}`)) / 3600000;
            if(d < 0) d += 24;
            document.getElementById('ot-val').innerText = d.toFixed(2) + " Jam";
        }

        document.getElementById('ot-form').onsubmit = async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button'); btn.innerText = "MENYIMPAN...";
            const payload = { 
                action: 'add_ot', 
                tarikh: document.getElementById('ot-date').value, 
                tugasan: document.getElementById('ot-task').value, 
                jumlahJam: parseFloat(document.getElementById('ot-val').innerText),
                linkSurat: document.getElementById('ot-link').value // Hantar Link Surat
            };
            await fetch(API, { method: 'POST', body: JSON.stringify(payload) });
            location.reload();
        };

        function runLogic() {
            const s = document.getElementById('lv-s').value, e = document.getElementById('lv-e').value;
            if(!s || !e) return;
            const d1 = new Date(s), d2 = new Date(e);
            const days = Math.ceil(Math.abs(d2 - d1) / 86400000) + 1;
            document.getElementById('lv-d').value = days + " Hari";
            
            let needed = 0; let temp = new Date(d1);
            for(let i=0; i<days; i++) { needed += (temp.getDay() === 4) ? 7.5 : 9; temp.setDate(temp.getDate()+1); }
            
            document.getElementById('val-perlu').innerText = needed.toFixed(2) + "j";
            document.getElementById('info-box').classList.remove('hidden');
            
            const baki = parseFloat(document.getElementById('stat-baki').innerText);
            const msg = document.getElementById('msg');
            const btn = document.getElementById('lv-btn');
            
            if(needed > baki) { msg.innerText = "Baki Jam Tidak Mencukupi"; msg.className="text-red-500 py-1"; btn.disabled = true; btn.style.opacity = "0.3"; }
            else { msg.innerText = "Kelayakan Mencukupi"; msg.className="text-emerald-400 py-1"; btn.disabled = false; btn.style.opacity = "1"; }
        }

        async function load() {
            const res = await fetch(API); const json = await res.json();
            const body = document.getElementById('table-body'); let total = 0;
            json.data.forEach(r => {
                if(r.status === 'Tersedia') total += parseFloat(r.jumlahJam);
                
                // Cek jika ada link surat
                const linkBtn = r.linkSurat ? `<a href="${r.linkSurat}" target="_blank" class="text-blue-400 hover:text-white transition">üîó Buka</a>` : `<span class="opacity-20">-</span>`;

                body.innerHTML += `
                    <tr class="hover:bg-white/5 transition-colors">
                        <td class="p-5 text-slate-400">${new Date(r.tarikh).toLocaleDateString('ms-MY')}</td>
                        <td class="p-5 font-bold uppercase tracking-tight">${r.tugasan}</td>
                        <td class="p-5 text-center font-black text-blue-400 italic">${parseFloat(r.jumlahJam).toFixed(2)}j</td>
                        <td class="p-5 text-center">${linkBtn}</td>
                        <td class="p-5 text-right">
                            <span class="px-3 py-1 rounded-full text-[8px] font-black uppercase ${r.status==='Tersedia'?'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20':'bg-red-500/10 text-red-500 border border-red-500/20'}">
                                ${r.status}
                            </span>
                        </td>
                    </tr>`;
            });
            document.getElementById('stat-baki').innerText = total.toFixed(2);
        }
        load();
    </script>
</body>
</html>
